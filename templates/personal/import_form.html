{% extends 'base.html' %}

{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-file-import"></i> {{ titulo }}</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> Instrucciones:</h5>
                    <ol>
                        <li><strong>Descarga la plantilla</strong>:
                            <ul>
                                <li>Para <strong>actualizar datos existentes</strong>: Usa el botón "Exportar" en la lista (contiene datos actuales)</li>
                                <li>Para <strong>datos nuevos desde cero</strong>: <a href="?plantilla=vacia" class="btn btn-sm btn-outline-primary"><i class="fas fa-download"></i> Descargar Plantilla Vacía</a></li>
                            </ul>
                        </li>
                        <li><strong>Edita el archivo Excel</strong> según necesites:
                            <ul>
                                <li>Puedes <strong>modificar</strong> los datos existentes</li>
                                <li>Puedes <strong>agregar</strong> nuevas filas</li>
                                <li>⚠️ <strong>No modifiques</strong> las hojas de catálogos (CAT_*)</li>
                                <li>✓ Usa las <strong>listas desplegables</strong> en las celdas para evitar errores</li>
                            </ul>
                        </li>
                        <li><strong>Guarda el archivo</strong> y súbelo aquí</li>
                        <li>El sistema <strong>creará</strong> los registros nuevos y <strong>actualizará</strong> los existentes</li>
                    </ol>
                </div>

                <div class="alert alert-warning">
                    <strong><i class="fas fa-exclamation-triangle"></i> Importante:</strong>
                    <ul class="mb-0">
                        <li>El archivo debe estar en formato <strong>.xlsx</strong></li>
                        <li>Los registros se identifican por su campo único (DNI para Personal, Nombre para Áreas/SubÁreas)</li>
                        <li>Si un registro ya existe, se <strong>actualizará</strong> con los nuevos datos</li>
                        <li>Si un registro no existe, se <strong>creará</strong> uno nuevo</li>
                    </ul>
                </div>

                <form method="post" enctype="multipart/form-data" class="mt-4">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>Errores en el formulario:</strong>
                        {{ form.errors }}
                    </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label for="{{ form.archivo.id_for_label }}" class="form-label">
                            <i class="fas fa-file-excel"></i> Archivo Excel (.xlsx)
                        </label>
                        {{ form.archivo }}
                        {% if form.archivo.help_text %}
                        <div class="form-text">{{ form.archivo.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                        <a href="{{ request.META.HTTP_REFERER|default:'/' }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Importar Datos
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card shadow-sm mt-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Hojas del Archivo Excel</h5>
            </div>
            <div class="card-body">
                <p>El archivo Excel exportado contiene las siguientes hojas:</p>
                <ul>
                    <li><strong>Hoja Principal:</strong> Contiene los datos actuales que puedes editar</li>
                    <li><strong>Hojas CAT_* (Catálogos):</strong> Contienen listas de valores válidos
                        <ul>
                            <li><code>CAT_Áreas</code> - Lista de áreas</li>
                            <li><code>CAT_Areas</code> - Lista de SubÁreas</li>
                            <li><code>CAT_TipoDoc</code>, <code>CAT_Estado</code>, etc. - Otros catálogos</li>
                        </ul>
                    </li>
                </ul>
                <p class="mb-0"><strong>Nota:</strong> Las celdas con listas desplegables están configuradas automáticamente para que solo puedas seleccionar valores válidos.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
