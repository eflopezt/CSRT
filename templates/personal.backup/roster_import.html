{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Importar Roster{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-file-upload"></i> Importar Roster desde Excel
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> Instrucciones:</h5>
                    <ol>
                        <li><strong>Descarga la plantilla</strong> usando el botón "Exportar Roster" en la vista matricial</li>
                        <li><strong>Edita el archivo Excel</strong>:
                            <ul>
                                <li>Completa los códigos en las columnas Dia01, Dia02, etc.</li>
                                <li>Usa las <strong>listas desplegables</strong> para seleccionar códigos válidos</li>
                                <li>Códigos: <code>T</code>, <code>TR</code>, <code>DL</code>, <code>DOL</code>, <code>DM</code>, <code>V</code>, <code>F</code>, <code>FC</code></li>
                            </ul>
                        </li>
                        <li><strong>Selecciona el mes y año</strong> para el cual deseas importar</li>
                        <li><strong>Sube el archivo</strong> y se actualizarán los registros</li>
                    </ol>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i> 
                    Si ya existen registros para las mismas fechas, serán <strong>actualizados</strong> con los nuevos valores.
                </div>

                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="mes" class="form-label"><i class="fas fa-calendar"></i> Mes</label>
                            <select name="mes" id="mes" class="form-select" required>
                                <option value="1" {% if mes == 1 %}selected{% endif %}>Enero</option>
                                <option value="2" {% if mes == 2 %}selected{% endif %}>Febrero</option>
                                <option value="3" {% if mes == 3 %}selected{% endif %}>Marzo</option>
                                <option value="4" {% if mes == 4 %}selected{% endif %}>Abril</option>
                                <option value="5" {% if mes == 5 %}selected{% endif %}>Mayo</option>
                                <option value="6" {% if mes == 6 %}selected{% endif %}>Junio</option>
                                <option value="7" {% if mes == 7 %}selected{% endif %}>Julio</option>
                                <option value="8" {% if mes == 8 %}selected{% endif %}>Agosto</option>
                                <option value="9" {% if mes == 9 %}selected{% endif %}>Septiembre</option>
                                <option value="10" {% if mes == 10 %}selected{% endif %}>Octubre</option>
                                <option value="11" {% if mes == 11 %}selected{% endif %}>Noviembre</option>
                                <option value="12" {% if mes == 12 %}selected{% endif %}>Diciembre</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="anio" class="form-label"><i class="fas fa-calendar-alt"></i> Año</label>
                            <input type="number" name="anio" id="anio" class="form-control" value="{{ anio }}" min="2020" max="2030" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.archivo.id_for_label }}" class="form-label">
                            <i class="fas fa-file-excel"></i> Archivo Excel (.xlsx)
                        </label>
                        {{ form.archivo }}
                        {% if form.archivo.help_text %}
                        <div class="form-text">{{ form.archivo.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                        <a href="{% url 'roster_matricial' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-upload"></i> Importar Roster
                        </button>
                    </div>
                </form>

                <hr>

                <h6><i class="fas fa-download"></i> Plantilla de ejemplo:</h6>
                <p class="text-muted">Descarga esta plantilla de Excel como referencia:</p>
                <a href="{% url 'roster_export' %}" class="btn btn-outline-primary">
                    <i class="fas fa-file-excel"></i> Descargar Plantilla Actual
                </a>
            </div>
        </div>
        
        <div class="mt-3">
            <a href="{% url 'roster_matricial' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver al Roster
            </a>
        </div>
    </div>
</div>
{% endblock %}
